import pdftotext
from scidownl.scihub import *
import pymysql
import re
import os

connection = pymysql.connect(host='127.0.0.1', user='root', port=3306, password='', db='forensics', cursorclass=pymysql.cursors.DictCursor)

cursor = connection.cursor()

#get all DOIs
n = cursor.execute('select id,doi from papers') 
c = cursor.fetchall()


for i in range(160):
    print(i)
    print('-------------------------------')
    paper_id=c[i]['id']
    paper_doi = c[i]['doi']
    try:
        sci = SciHub(paper_doi, str(paper_id)).download(choose_scihub_url_index=3)
    except:
        print("not found: " + str(paper_id))
        continue
    n = os.listdir("./"+str(paper_id))
    with open("./"+str(paper_id)+"/"+n[0], 'rb') as f:
    	pdf = pdftotext.PDF(f)
    with open("./"+str(paper_id)+"/"+str(paper_id), 'w') as f1:
    	f1.write("\n\n".join(pdf))










'''	
pdfFileObj= open('Sandnet.pdf', 'rb')
newFile = open('a.text', 'wb')
pdfReader = PyPDF2.PdfFileReader(pdfFileObj)

#pdfWriter =PyPDF2.PdfFileWriter()
nPages= pdfReader.numPages

for i in range(0, nPages):
    pageObj = pdfReader.getPage(0)
    t.append(bytes(pageObj.extractText(), 'utf-8'))

newFile.write(t)

pdfFileObj.close()
'''